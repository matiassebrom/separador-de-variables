<div class="step1-container">
	<h2>
		<mat-icon>cloud_upload</mat-icon>
		&nbsp; 1) Subir archivo
	</h2>

	<div class="step-content">
		<mat-card
			class="upload-card"
			*ngIf="!fileUploaded">
			<mat-card-content>
				<div class="upload-area">
					<div class="upload-content">
						<div
							class="file-drop-area"
							(drop)="onFileDrop($event)"
							(dragover)="onDragOver($event)"
							(dragleave)="onDragLeave($event)"
							[class.dragover]="isDragOver()"
							[class.uploading]="isUploading()">
							@if (isUploading()) {
							<mat-spinner diameter="40"></mat-spinner>
							<p>Subiendo archivo...</p>
							} @else {
							<mat-icon
								class="upload-icon"
								style="font-size: 48px"
								>cloud_upload</mat-icon
							>
							<p class="hint">Arrastra tu archivo Excel aquÃ­</p>
							}

							<input
								#fileInput
								type="file"
								accept=".xlsx,.xls"
								(change)="onFileSelected($event)"
								style="display: none" />
						</div>

						@if (selectedFile(); as file) {
						<div class="selected-file-info">
							<mat-icon>description</mat-icon>
							<span>{{ file.name }}</span>
						</div>
						}

						<!-- ðŸ“Š Estado del upload -->
						@if (uploadStatus()) {
						<div
							class="upload-status"
							[class.error]="uploadStatus().includes('âŒ')"
							[class.success]="uploadStatus().includes('âœ“')">
							{{ uploadStatus() }}
						</div>
						}
					</div>
				</div>
				<div class="buttons-container">
					<button
						mat-stroked-button
						color="primary"
						style="margin-top: 1.5rem"
						(click)="fileInput.click()"
						[disabled]="isUploading()">
						<mat-icon>folder_open</mat-icon>
						Elegir archivo
					</button>
					<button
						mat-raised-button
						color="primary"
						[disabled]="!selectedFile() || isUploading()"
						(click)="onFileUpload()"
						style="margin-top: 1.5rem">
						@if (isUploading()) {
						<mat-spinner diameter="16"></mat-spinner>
						<span>Subiendo...</span>
						} @else {
						<ng-container>
							<mat-icon>cloud_upload</mat-icon>
							<span>Subir archivo</span>
						</ng-container>
						}
					</button>

					<!-- ðŸ§ª BotÃ³n de prueba para obtener headers -->
					<button
						mat-stroked-button
						color="accent"
						style="margin-top: 1.5rem"
						(click)="testGetHeaders()"
						[disabled]="!fileStateService.hasFile()">
						<mat-icon>list</mat-icon>
						Probar obtener headers
					</button>
				</div>
			</mat-card-content>
		</mat-card>

		<mat-card *ngIf="fileUploaded">
			<mat-card-content>
				<div class="success-message">
					<mat-icon class="success-icon">check_circle</mat-icon>
					<div>
						<p><strong>Archivo:</strong> {{ fileStateService.filename() || 'excel para test.xlsx' }}</p>
						<p><strong>File ID:</strong> {{ fileStateService.fileId() }}</p>
						<p><strong>Estado:</strong> âœ… Cargado exitosamente</p>
						<p>Â¡El archivo se cargÃ³ correctamente! Ahora puedes continuar con el siguiente paso.</p>
					</div>
				</div>
			</mat-card-content>
		</mat-card>
	</div>
</div>
