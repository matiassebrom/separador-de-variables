<mat-expansion-panel [expanded]="isStepCurrent" [disabled]="!canAccessStep">
	<mat-expansion-panel-header>
		<mat-panel-title>
			<mat-icon>{{
				isStepCompleted ? 'check_circle' : isStepCurrent ? 'radio_button_checked' : 'radio_button_unchecked'
			}}</mat-icon>
			&nbsp; 2) Elegir 'Separar por'
		</mat-panel-title>
		<mat-panel-description *ngIf="isStepCompleted"> Separar por: {{ selectedSeparateBy }} </mat-panel-description>
	</mat-expansion-panel-header>

	<div class="step-content">
		<!-- âœ… Buscador y selector de columna -->
		<div *ngIf="fileStateService.hasFile() && fileStateService.headers().length > 0">
			<mat-form-field appearance="outline" class="mat-form-field-fluid">
				<mat-label>Separar por (columna)</mat-label>
				<mat-select [value]="selectedSeparateBy" (selectionChange)="onSeparateByChange($event.value)">
					<mat-option>
						<input
							matInput
							placeholder="Buscar columna..."
							[(ngModel)]="headerSearchTerm"
							(click)="$event.stopPropagation()"
							(keydown)="$event.stopPropagation()"
							style="width: 100%"
						/>
					</mat-option>
					<mat-option value="">( ninguna )</mat-option>
					<mat-option *ngFor="let header of filteredHeaders" [value]="header">
						{{ header }}
					</mat-option>
				</mat-select>
			</mat-form-field>

			<div class="step-actions">
				<button mat-raised-button color="primary" [disabled]="!selectedSeparateBy" (click)="onContinueClick()">
					Continuar
				</button>
			</div>
		</div>

		<!-- ðŸ“ InformaciÃ³n adicional -->
		<div *ngIf="!fileStateService.hasFile()" class="info-state mat-body-1">
			<mat-icon color="accent">info</mat-icon>
			<span>Primero debes subir un archivo en el paso anterior</span>
		</div>
	</div>
</mat-expansion-panel>
