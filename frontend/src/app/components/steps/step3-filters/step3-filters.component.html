<mat-expansion-panel [expanded]="isStepCurrent" [disabled]="!canAccessStep">
	<mat-expansion-panel-header>
		<mat-panel-title>
			<mat-icon>{{
				isStepCompleted ? 'check_circle' : isStepCurrent ? 'radio_button_checked' : 'radio_button_unchecked'
			}}</mat-icon>
			&nbsp; 3) Configurar filtros (opcional)
		</mat-panel-title>
		<mat-panel-description *ngIf="selectedColumnValues.length > 0">
			Filtrar por: {{ selectedFilterColumn }} {{ selectedColumnValues.join(', ') }}
		</mat-panel-description>
	</mat-expansion-panel-header>
	<div class="step-content">
		<p>Pod√©s agregar filtros para incluir/excluir que datos vas a exportar. Es opcional.</p>
		<mat-form-field appearance="outline" class="mat-form-field-fluid">
			<mat-label>Columna a filtrar </mat-label>
			<mat-select [ngModel]="selectedFilterColumn" (ngModelChange)="onFilterColumnChange($event)">
				<mat-option>
					<input
						matInput
						placeholder="Buscar columna..."
						[(ngModel)]="headerSearchTerm"
						(click)="$event.stopPropagation()"
						(keydown)="$event.stopPropagation()"
						style="width: 100%"
					/>
				</mat-option>
				<mat-option value="">( ninguna )</mat-option>
				<mat-option *ngFor="let header of filteredHeaders" [value]="header">
					{{ header }}
				</mat-option>
			</mat-select>
		</mat-form-field>

		<mat-form-field appearance="outline" class="mat-form-field-fluid">
			<mat-label>Valores permitidos (columna)</mat-label>
			<mat-select multiple>
				<mat-option *ngFor="let value of columnValues" (click)="toggleColumnValue(value)">
					{{ value }}
				</mat-option>
			</mat-select>
		</mat-form-field>

		<div class="current-filters" *ngIf="selectedColumnValues.length > 0">
			<p><strong>Filtros actuales:</strong></p>
			<mat-chip-listbox>
				<mat-chip> {{ selectedColumnValues.join(', ') }}</mat-chip>
			</mat-chip-listbox>
		</div>

		<div class="step-actions">
			<button mat-button (click)="clearFilters()">Limpiar filtros</button>
			<button mat-raised-button color="primary" (click)="onContinue()">Continuar</button>
		</div>
	</div>
</mat-expansion-panel>
